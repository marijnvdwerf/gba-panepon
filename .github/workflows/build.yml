on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    container: devkitpro/devkitarm

    steps:
      - uses: actions/checkout@v2
#      - run: pushd $HOME
#      - run: wget https://github.com/devkitPro/pacman/releases/download/devkitpro-pacman-1.0.1/devkitpro-pacman.deb
#      - run: sudo dpkg -i devkitpro-pacman.deb
#      - run: sudo dkp-pacman -Sy
#      - run: sudo dkp-pacman -Syu
#      - run: sudo dkp-pacman -S -v --noconfirm devkitARM gba-tools
#      - run: export DEVKITPRO=/opt/devkitpro
#      - run: export DEVKITARM=${DEVKITPRO}/devkitARM
      - run: pacman -S gcc

      - uses: actions/checkout@v2
        with:
          repository: pret/agbcc
          path: agbcc
      - run: ./build.sh
        working-directory: agbcc

      - uses: actions/checkout@v2
        with:
          repository: pret/pokeruby
          path: pokeruby
      - run: ./build_tools.sh
        working-directory: pokeruby

#      - run: popd
      - run: mkdir -p build
      - run: cd build
      - run: /usr/bin/cmake -DCMAKE_TOOLCHAIN_FILE=../gba.toolchain.cmake ..
      - run: make
      - run: make validate